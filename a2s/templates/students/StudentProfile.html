    {% extends "students/student_base.html" %}
    {% load static %}

    {% block title %}Student Profile - A2S{% endblock %}

    {% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/students/student_profile.css' %}">
    {% endblock %}

    {% block content %}
    <div class="profile-page-container">

        <div class="header-info" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>Student Profile</h1>
                <p>Manage your account information</p>
            </div>
            <button id="edit-profile-button" class="edit-profile-button">
                <i data-lucide="edit"></i> Edit Profile
            </button>
        </div>

        <!-- Add data attributes for JS -->
        <div id="profile-container" class="read-only"
            data-upload-url="{% url 'UploadProfilePicture' %}"
            data-update-profile-url="{% url 'UpdateStudentProfile' %}"
            data-csrf-token="{{ csrf_token }}">

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab-list">
                    <button class="tab-trigger active" data-tab="personal">Personal Info</button>
                    <button class="tab-trigger" data-tab="academic">Academic Info</button>
                    <button class="tab-trigger" data-tab="achievements">Achievements</button>
                </div>

                <!-- Personal Info -->
                <div class="tab-content active" id="personal">
                    <div class="profile-grid">

                        <!-- Profile Picture Card -->
                        <div class="profile-picture-card">
                            <div class="profile-picture-wrapper" style="position: relative;">
                                <div class="profile-picture" id="profile-picture">
                                    {% if profile_picture_url %}
                                        <img src="{{ profile_picture_url }}" alt="Profile Picture">
                                    {% else %}
                                        <i data-lucide="user"></i>
                                    {% endif %}
                                </div>

                                <!-- Hidden file input -->
                                <input type="file" id="profile-picture-input" style="display:none;">

                                <!-- Tiny edit button (only visible in edit mode) -->
                                <button id="edit-profile-pic-button" class="edit-profile-pic-button" 
                                        style="position: absolute; bottom: 5px; right: 5px; display: none;">
                                    <i data-lucide="edit-2"></i>
                                </button>
                            </div>

                            <h2 class="profile-name" data-field="full_name">{{ first_name }} {{ last_name }}</h2>
                            <div class="profile-badge" data-field="year_major">{{ academic_year }} â€¢ {{ major }}</div>
                        </div>

                        <!-- Contact Information -->
                        <div class="contact-card">
                            <h3 class="card-title"><i data-lucide="mail"></i> Contact Information</h3>

                            <div class="form-field">
                                <label>First Name</label>
                                <p class="field-value" data-field="first_name">{{ first_name }}</p>
                                <div class="editable-field">
                                    <input type="text" name="first_name" value="{{ first_name }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Last Name</label>
                                <p class="field-value" data-field="last_name">{{ last_name }}</p>
                                <div class="editable-field">
                                    <input type="text" name="last_name" value="{{ last_name }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Email</label>
                                <p class="field-value" data-field="email">{{ email }}</p>
                            </div>

                            <div class="form-field">
                                <label>Phone Number</label>
                                <p class="field-value" data-field="phone">{{ phone|default:'' }}</p>
                                <div class="editable-field">
                                    <input type="text" name="phone" value="{{ phone }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Address</label>
                                <p class="field-value" data-field="address">{{ address|default:'' }}</p>
                                <div class="editable-field">
                                    <input type="text" name="address" value="{{ address }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Date of Birth</label>
                                <p class="field-value" data-field="dob">{{ dob_display }}</p>
                                <div class="editable-field">
                                    <input type="date" name="dob" value="{{ dob|date:'Y-m-d' }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Bio</label>
                                <p class="field-value" data-field="bio">{{ bio|default:'' }}</p>
                                <div class="editable-field">
                                    <textarea name="bio">{{ bio }}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Info -->
                <div class="tab-content" id="academic">
                    <div class="academic-grid">
                        <div class="card">
                            <h3 class="card-title"><i data-lucide="graduation-cap"></i> Academic Details</h3>

                            <div class="form-field">
                                <label>Student ID</label>
                                <p class="field-value" data-field="student_id">{{ student_id|default:'' }}</p>
                            </div>

                            <div class="form-field">
                                <label>Major</label>
                                <p class="field-value" data-field="major">{{ major }}</p>
                                <div class="editable-field">
                                    <input type="text" name="major" value="{{ major }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Academic Year</label>
                                <p class="field-value" data-field="academic_year">{{ academic_year|default:'' }}</p>
                                <div class="editable-field">
                                    <input type="number" name="academic_year" value="{{ academic_year }}" min="1" max="5">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Expected Graduation</label>
                                <p class="field-value" data-field="expected_graduation">{{ expected_graduation_display }}</p>
                                <div class="editable-field">
                                    <input type="date" name="expected_graduation" value="{{ expected_graduation|date:'Y-m-d' }}">
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="card-title"><i data-lucide="book-open"></i> Academic Progress</h3>

                            <div class="form-field">
                                <label>Current GPA</label>
                                <div class="gpa-display">
                                    <span class="gpa-value" data-field="gpa">{{ gpa|default:'' }}</span>
                                    <span class="gpa-max">/ 4.0</span>
                                </div>
                                <div class="editable-field">
                                    <input type="number" step="0.01" name="gpa" value="{{ gpa }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Credits Completed</label>
                                <div class="credits-display">
                                    <span class="credits-value" data-field="credits_completed">{{ credits_completed|default:'' }}</span>
                                    <span class="credits-max">/ {{ credits_required|default:'' }}</span>
                                </div>
                                <div class="editable-field">
                                    <input type="number" name="credits_completed" value="{{ credits_completed }}">
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Academic Standing</label>
                                <div class="status-badge success" data-field="academic_standing">{{ academic_standing|default:'Good Standing' }}</div>
                                <div class="editable-field">
                                    <input type="text" name="academic_standing" value="{{ academic_standing }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements -->
                <div class="tab-content" id="achievements">
                    <div class="card">
                        <h3 class="card-title"><i data-lucide="award"></i> Academic Achievements</h3>
                        <div class="achievements-grid" id="achievements-container">
                            {% for achievement in achievements %}
                            <div class="achievement-card" data-field="achievement_{{ forloop.counter }}">
                                <i data-lucide="{{ achievement.icon }}"></i>
                                <h4>{{ achievement.title }}</h4>
                                <div class="editable-field">
                                    <input type="text" name="achievement_{{ forloop.counter }}_title" value="{{ achievement.title }}">
                                    <input type="text" name="achievement_{{ forloop.counter }}_description" value="{{ achievement.description }}">
                                </div>
                                <p>{{ achievement.description }}</p>
                            </div>
                            {% empty %}
                            <p>No achievements yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>

            </div> <!-- end tabs -->
        </div> 

        <div class="profile-actions" style="display: none;" id="profile-actions">
            <button id="save-profile-button" class="save-button">Save Changes</button>
            <button id="cancel-profile-button" class="cancel-button">Cancel</button>
        </div>


    </div>

    <script src="{% static 'js/students/StudentProfile.js' %}"></script>


    {% endblock %}



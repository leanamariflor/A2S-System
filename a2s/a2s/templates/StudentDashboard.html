
{% extends "student_base.html" %}
{% load static %}

{% block title %}A2S Student Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/StudentDashboard.css' %}" />
{% endblock %}

{% block content %}

<!-- Welcome Section -->
<div class="welcome-card">
  <div class="welcome-content">
    <div class="welcome-text">
      <h2>Welcome back, {{ student.first_name }}</h2>
      <p>{{ current_semester }} • {{ active_courses_count }} active courses</p>
    </div>
    <div class="welcome-gpa">
      <div class="gpa-value">{{ student.gpa }}</div>
      <div class="gpa-label">Current GPA</div>
    </div>
  </div>
</div>


<!-- Dashboard Tabs -->
<div class="tabs">
  <div class="tab-list">
    <button class="tab-trigger active" data-tab="dashboard">Overview</button>
    <button class="tab-trigger" data-tab="calendar">Academic Calendar</button>
    <button class="tab-trigger" data-tab="curriculum">Curriculum</button>
    <button class="tab-trigger" data-tab="grades">Progress</button>
  </div>

  <!-- Dashboard Tab -->
  <div class="tab-content active" id="dashboard">
    <div class="quick-actions-grid">
      <div class="action-card"><i data-lucide="calendar"></i><h3>Schedule</h3><p>View timetable</p></div>
      <div class="action-card"><i data-lucide="file-text"></i><h3>View Grades</h3><p>Check your scores</p></div>
      <div class="action-card"><i data-lucide="trending-up"></i><h3>Degree Audit</h3><p>Track your progress</p></div>
      <div class="action-card"><i data-lucide="trophy"></i><h3>Achievements</h3><p>Check your achievements</p></div>
    </div>

    <div class="cards-row">
      <!-- Current Courses Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Current Courses</div>
          <div class="card-description">Fall 2025 • 4 enrolled courses</div>
        </div>
        <div class="card-content">
          <div class="course-list">
            <div class="course-item"><div class="course-details"><div class="course-code">IT317</div><div class="course-name">Systems Integration</div><div class="course-instructor">Prof. Revilleza</div></div><div class="course-units">3 units</div></div>
            <div class="course-item"><div class="course-details"><div class="course-code">CSIT327</div><div class="course-name">Database Systems</div><div class="course-instructor">Prof. Revilleza</div></div><div class="course-units">3 units</div></div>
            <div class="course-item"><div class="course-details"><div class="course-code">IT315</div><div class="course-name">Web Development</div><div class="course-instructor">Prof. Revilleza</div></div><div class="course-units">3 units</div></div>
            <div class="course-item"><div class="course-details"><div class="course-code">CSIT340</div><div class="course-name">Industry Elective 2</div><div class="course-instructor">Prof. Revilleza</div></div><div class="course-units">3 units</div></div>
          </div>
        </div>
      </div>

      <!-- Recent Notifications Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Recent Notifications</div>
          <div class="card-description">Important updates for you</div>
        </div>
        <div class="card-content">
          <div class="task-list">
            <div class="task-item"><div class="task-details"><div class="task-title">Assignment 3 Deadline</div><div class="task-due">Due: Oct 5, 2025</div></div><div class="task-type">Urgent</div></div>
            <div class="task-item"><div class="task-details"><div class="task-title">Midterm Exam Schedule</div><div class="task-due">Starts: Nov 10, 2025</div></div><div class="task-type">Exam</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<div class="tab-content" id="curriculum">
  <div class="card curriculum-card">
    <div class="card-header curriculum-header">
      <div>
        <div class="card-title">Curriculum</div>
      </div>

      <div class="curriculum-controls">
        <select id="yearSelect" class="year-dropdown">
          <option value="All">All Years</option>
          <option value="First Year">1st Year</option>
          <option value="Second Year">2nd Year</option>
          <option value="Third Year">3rd Year</option>
          <option value="Fourth Year">4th Year</option>
        </select>

        <div class="curriculum-buttons">
          <button class="filter-btn active" data-filter="All">All</button>
          <button class="filter-btn" data-filter="PASSED">Completed</button>
          <button class="filter-btn" data-filter="CURRENT">Current</button>
          <button class="filter-btn" data-filter="RECOMMENDED">Recommended</button>
        </div>
      </div>
    </div>

    <div class="card-content curriculum-content">
      <div id="curriculum-container" class="curriculum-table">
        <p>Loading curriculum data...</p>
        <p>Program: {{ student.program }}</p>

      </div>
    </div>
  </div>
</div>


  

  <div class="tab-content" id="grades">
    <div class="card">
      <div class="card-header"><div class="card-title">Grades</div><div class="card-description">View your scores and feedback</div></div>
      <div class="card-content"><p>Grades overview UI placeholder.</p></div>
    </div>
  </div>

  <div class="tab-content" id="calendar">
    <div class="card">
      <div class="card-header"><div class="card-title">Academic Calendar</div><div class="card-description">Important academic dates</div></div>
      <div class="card-content"><p>Calendar content placeholder.</p></div>
    </div>
  </div>

  <div class="tab-content" id="map">
    <div class="card">
      <div class="card-header"><div class="card-title">University Map</div><div class="card-description">Campus locations and buildings</div></div>
      <div class="card-content"><p>Map embedding placeholder.</p></div>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  lucide.createIcons(); // Initialize Lucide icons

  // -------------------- Tabs --------------------
  const tabTriggers = document.querySelectorAll('.tab-trigger');
  const tabContents = document.querySelectorAll('.tab-content');
  tabTriggers.forEach(trigger => {
    trigger.addEventListener('click', () => {
      const target = trigger.dataset.tab;
      tabTriggers.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      trigger.classList.add('active');
      document.getElementById(target).classList.add('active');
    });
  });

  // -------------------- Curriculum --------------------
  const container = document.getElementById("curriculum-container");
  let allData = [];

    try {
    allData = JSON.parse('{{ curriculum_json|escapejs }}') || [];
  } catch(e) {
    console.error("Error parsing curriculum JSON:", e);
    container.innerHTML = `<p style="color:red;">Error loading curriculum data.</p>`;
  }

  const studentProgram = "{{ student_program }}"; // e.g., "BSIT"

  if (!studentProgram || studentProgram === "Undeclared") {
    container.innerHTML = `<p style="color:red;">Program not set for this student.</p>`;
  } else {
    renderCurriculum(allData);
  }

  fetch(`/api/curriculum/${studentProgram}/`)
    .then(response => {
      if (!response.ok) throw new Error("Curriculum not found for " + studentProgram);
      return response.json();
    })
    .then(data => {
      allData = data.curriculum || [];
      renderCurriculum(allData);
    })
    .catch(err => {
      container.innerHTML = `<p style="color:red;">Error loading curriculum: ${err.message}</p>`;
      console.error(err);
    });

  // -------------------- Render Function --------------------
  function renderCurriculum(curriculum) {
    container.innerHTML = "";

    if (!curriculum.length) {
      container.innerHTML = "<p>No curriculum data available for this program.</p>";
      return;
    }

    curriculum.forEach(year => {
      const yearBlock = document.createElement("div");
      yearBlock.classList.add("year-block");
      yearBlock.innerHTML = `<h3>${year.year}</h3>`;

      year.terms.forEach(term => {
        const table = document.createElement("table");

        const header = `
          <thead>
            <tr>
              <th>Term</th>
              <th>Subject Code</th>
              <th>Description</th>
              <th>Units</th>
              <th>School Year</th>
              <th>Semester</th>
              <th>Status</th>
            </tr>
          </thead>
        `;

        const rows = term.subjects.map(subj => `
          <tr data-status="${subj.final_grade}">
            <td>${term.term}</td>
            <td>${subj.subject_code}</td>
            <td>${subj.description}</td>
            <td>${subj.units}</td>
            <td>${subj.school_year}</td>
            <td>${subj.semester}</td>
            <td>${subj.final_grade}</td>
          </tr>
        `).join("");

        table.innerHTML = header + `<tbody>${rows}</tbody>`;
        yearBlock.appendChild(table);
      });

      container.appendChild(yearBlock);
    });
  }

  // -------------------- Filters --------------------
  const yearSelect = document.getElementById("yearSelect");
  const buttons = document.querySelectorAll(".filter-btn");

function filterCurriculum() {
  const selectedYear = yearSelect.value;
  const activeBtn = document.querySelector(".filter-btn.active");
  const selectedStatus = activeBtn ? activeBtn.dataset.filter.toUpperCase() : "ALL";

  let filtered = allData;

  // Filter by year
  if (selectedYear !== "All") {
    filtered = filtered.filter(y => y.year.toLowerCase() === selectedYear.toLowerCase());
  }

  // Filter by status
  if (selectedStatus !== "ALL") {
    filtered = filtered.map(year => ({
      ...year,
      terms: year.terms.map(term => ({
        ...term,
        subjects: term.subjects.filter(s => {
          // Ensure comparison is uppercase
          return (s.final_grade || "").toUpperCase() === selectedStatus;
        })
      })).filter(term => term.subjects.length > 0)
    })).filter(year => year.terms.length > 0);
  }

  renderCurriculum(filtered);
}

  yearSelect.addEventListener("change", filterCurriculum);
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      buttons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      filterCurriculum();
    });
  });
});
</script>



{% endblock %}


{% extends "student_base.html" %}
{% load static %}

{% block title %}Student Profile - A2S{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/student_profile.css' %}">
<link rel="stylesheet" href="{% static 'css/edit_profile_modal.css' %}">
{% endblock %}

{% block content %}
<div class="profile-page-container">

    <!-- Header with Edit Profile Button -->
    <div class="header-info" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>Student Profile</h1>
            <p>Manage your account information</p>
        </div>
        <button class="edit-profile-button">
            <i data-lucide="edit"></i> Edit Profile
        </button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab-list">
            <button class="tab-trigger active" data-tab="personal">Personal Info</button>
            <button class="tab-trigger" data-tab="academic">Academic Info</button>
            <button class="tab-trigger" data-tab="achievements">Achievements</button>
        </div>

        <!-- Personal Info -->
        <div class="tab-content active" id="personal">
            <div class="profile-grid">
                <div class="profile-picture-card">
                    <div class="profile-picture-wrapper">
                        <div class="profile-picture"><i data-lucide="user"></i></div>
                        <button class="camera-button"><i data-lucide="camera"></i></button>
                    </div>
                    <h2 class="profile-name" id="displayName">John Doe</h2>
                    <div class="profile-badge">Senior • Computer Science</div>
                </div>

                <div class="contact-card">
                    <h3 class="card-title"><i data-lucide="mail"></i> Contact Information</h3>
                    <div class="form-grid">
                        <div class="form-field">
                            <label>First Name</label>
                            <p class="field-value" id="displayFirstName">John</p>
                        </div>
                        <div class="form-field">
                            <label>Last Name</label>
                            <p class="field-value" id="displayLastName">Doe</p>
                        </div>
                    </div>
                    <div class="form-field">
                        <label>Email Address</label>
                        <p class="field-value field-with-icon" id="displayEmail">
                            <i data-lucide="mail"></i> john.doe@student.edu
                        </p>
                    </div>
                    <div class="form-field">
                        <label>Phone Number</label>
                        <p class="field-value field-with-icon" id="displayPhone">
                            <i data-lucide="phone"></i> +1 (555) 123-4567
                        </p>
                    </div>
                    <div class="form-field">
                        <label>Address</label>
                        <p class="field-value field-with-icon" id="displayAddress">
                            <i data-lucide="map-pin"></i> 123 University Ave, Campus City
                        </p>
                    </div>
                    <div class="form-field">
                        <label>Date of Birth</label>
                        <p class="field-value field-with-icon"><i data-lucide="calendar"></i> May 15, 1999</p>
                    </div>
                    <div class="form-field">
                        <label>Bio</label>
                        <p class="field-value" id="displayBio">
                            Computer Science student passionate about software development and AI.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Academic Info -->
        <div class="tab-content" id="academic">
            <div class="academic-grid">
                <div class="card">
                    <h3 class="card-title"><i data-lucide="graduation-cap"></i> Academic Details</h3>
                    <div class="form-field"><label>Student ID</label><p class="field-value">CS-2021-001234</p></div>
                    <div class="form-field"><label>Major</label><p class="field-value">Computer Science</p></div>
                    <div class="form-field"><label>Minor</label><p class="field-value">Mathematics</p></div>
                    <div class="form-field"><label>Academic Year</label><p class="field-value">Senior</p></div>
                    <div class="form-field"><label>Expected Graduation</label><p class="field-value">May 2025</p></div>
                </div>

                <div class="card">
                    <h3 class="card-title"><i data-lucide="book-open"></i> Academic Progress</h3>
                    <div class="form-field">
                        <label>Current GPA</label>
                        <div class="gpa-display"><span class="gpa-value">3.85</span><span class="gpa-max">/ 4.0</span></div>
                    </div>
                    <div class="form-field">
                        <label>Credits Completed</label>
                        <div class="credits-display"><span class="credits-value">105</span><span class="credits-max">/ 120</span></div>
                        <div class="progress-bar"><div class="progress-fill" style="width: 87.5%"></div></div>
                    </div>
                    <div class="form-field">
                        <label>Academic Standing</label>
                        <div class="status-badge success">Good Standing</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements -->
        <div class="tab-content" id="achievements">
            <div class="card">
                <h3 class="card-title"><i data-lucide="award"></i> Academic Achievements</h3>
                <div class="achievements-grid">
                    <div class="achievement-card"><i data-lucide="award"></i><h4>Dean's List</h4><p>Fall 2023, Spring 2024</p></div>
                    <div class="achievement-card"><i data-lucide="graduation-cap"></i><h4>Academic Excellence</h4><p>Cum Laude Track</p></div>
                    <div class="achievement-card"><i data-lucide="book-open"></i><h4>Research Publication</h4><p>AI in Education, 2024</p></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal-overlay">
  <div class="modal-content">
    <h2>Edit Profile</h2>
    <form id="editProfileForm">
      {% csrf_token %}
      <div class="form-grid">
        <div class="form-field">
          <label>First Name</label>
          <input type="text" id="first_name" value="John">
        </div>
        <div class="form-field">
          <label>Last Name</label>
          <input type="text" id="last_name" value="Doe">
        </div>
        <div class="form-field">
          <label>Email</label>
          <input type="email" id="email" value="john.doe@student.edu">
        </div>
        <div class="form-field">
          <label>Phone</label>
          <input type="text" id="phone" value="+1 (555) 123-4567">
        </div>
        <div class="form-field">
          <label>Address</label>
          <input type="text" id="address" value="123 University Ave, Campus City">
        </div>
        <div class="form-field">
          <label>Bio</label>
          <textarea id="bio">Computer Science student passionate about software development and AI.</textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" id="cancelEdit">Cancel</button>
        <button type="submit" class="save-button">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<script>
lucide.createIcons();

// Tabs
document.querySelectorAll('.tab-trigger').forEach(trigger => {
    trigger.addEventListener('click', () => {
        const targetTab = trigger.getAttribute('data-tab');
        document.querySelectorAll('.tab-trigger').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        trigger.classList.add('active');
        document.getElementById(targetTab).classList.add('active');
    });
});

// Modal functionality
document.addEventListener('DOMContentLoaded', function() {
    const editButton = document.querySelector('.edit-profile-button');
    const modal = document.getElementById('editProfileModal');
    const cancelBtn = document.getElementById('cancelEdit');
    const form = document.getElementById('editProfileForm');

    // ✅ Load saved profile data from localStorage when page loads
    function loadProfile() {
        const savedProfile = JSON.parse(localStorage.getItem('studentProfile'));
        if (savedProfile) {
            document.getElementById('displayFirstName').textContent = savedProfile.first_name;
            document.getElementById('displayLastName').textContent = savedProfile.last_name;
            document.getElementById('displayEmail').innerHTML = `<i data-lucide="mail"></i> ${savedProfile.email}`;
            document.getElementById('displayPhone').innerHTML = `<i data-lucide="phone"></i> ${savedProfile.phone}`;
            document.getElementById('displayAddress').innerHTML = `<i data-lucide="map-pin"></i> ${savedProfile.address}`;
            document.getElementById('displayBio').textContent = savedProfile.bio;
            document.getElementById('displayName').textContent = `${savedProfile.first_name} ${savedProfile.last_name}`;
            
            // also update modal input fields with saved data
            form.first_name.value = savedProfile.first_name;
            form.last_name.value = savedProfile.last_name;
            form.email.value = savedProfile.email;
            form.phone.value = savedProfile.phone;
            form.address.value = savedProfile.address;
            form.bio.value = savedProfile.bio;

            lucide.createIcons();
        }
    }

    // Open modal
    editButton.addEventListener('click', () => modal.style.display = 'flex');

    // Close modal
    cancelBtn.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    // ✅ Save and update fields + persist to localStorage
    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const profileData = {
            first_name: form.first_name.value,
            last_name: form.last_name.value,
            email: form.email.value,
            phone: form.phone.value,
            address: form.address.value,
            bio: form.bio.value
        };

        // Save to localStorage
        localStorage.setItem('studentProfile', JSON.stringify(profileData));

        // Update visible fields immediately
        document.getElementById('displayFirstName').textContent = profileData.first_name;
        document.getElementById('displayLastName').textContent = profileData.last_name;
        document.getElementById('displayEmail').innerHTML = `<i data-lucide="mail"></i> ${profileData.email}`;
        document.getElementById('displayPhone').innerHTML = `<i data-lucide="phone"></i> ${profileData.phone}`;
        document.getElementById('displayAddress').innerHTML = `<i data-lucide="map-pin"></i> ${profileData.address}`;
        document.getElementById('displayBio').textContent = profileData.bio;
        document.getElementById('displayName').textContent = profileData.first_name + ' ' + profileData.last_name;

        modal.style.display = 'none';
        lucide.createIcons();
    });

    // Load data on page load
    loadProfile();
});
</script>

{% endblock %}

{% extends "faculty/teacher_base.html" %}
{% load static %}


{% block title %}Teacher Profile - A2S{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'faculty/css/TeacherProfile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-page-container">

    <!-- Header with Edit Profile Button -->
    <div class="header-info" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>Teacher Profile</h1>
            <p>Manage your account information</p>
        </div>
        <button id="edit-profile-button" class="edit-profile-button">
            <i data-lucide="edit"></i> Edit Profile
        </button>
    </div>

    <div id="profile-container" class="read-only">

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab-list">
                <button class="tab-trigger active" data-tab="personal">Personal Info</button>
                <button class="tab-trigger" data-tab="academic">Academic Info</button>
                <button class="tab-trigger" data-tab="achievements">Achievements</button>
            </div>

            <!-- Personal Info -->
            <div class="tab-content active" id="personal">
                <div class="profile-grid">

                    <!-- Profile Picture Card -->
                    <div class="profile-picture-card">
                        <div class="profile-picture-wrapper">
                            <div class="profile-picture"><i data-lucide="user"></i></div>
                            <div class="editable-field">
                                <input type="file" name="profile_picture">
                            </div>
                        </div>
                        <h2 class="profile-name" data-field="full_name">{{ first_name }} {{ last_name }}</h2>
                        <div class="profile-badge" data-field="department_position">
                        {{ department|default:"N/A" }} â€¢ {{ position|default:"N/A" }}
                        </div>                    
                    </div>

                    <!-- Contact Information -->
                    <div class="contact-card">
                        <h3 class="card-title"><i data-lucide="mail"></i> Contact Information</h3>

                        <div class="form-field">
                            <label>First Name</label>
                            <p class="field-value" data-field="first_name">{{ first_name }}</p>
                            <div class="editable-field">
                                <input type="text" name="first_name" value="{{ first_name }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Last Name</label>
                            <p class="field-value" data-field="last_name">{{ last_name }}</p>
                            <div class="editable-field">
                                <input type="text" name="last_name" value="{{ last_name }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Email</label>
                            <p class="field-value" data-field="email">{{ email }}</p>
                        </div>

                        <div class="form-field">
                            <label>Phone Number</label>
                            <p class="field-value" data-field="phone">{{ phone|default:'' }}</p>
                            <div class="editable-field">
                                <input type="text" name="phone" value="{{ phone }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Address</label>
                            <p class="field-value" data-field="address">{{ address|default:'' }}</p>
                            <div class="editable-field">
                                <input type="text" name="address" value="{{ address }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Date of Birth</label>
                            <p class="field-value" data-field="dob">{{ dob_display }}</p>
                            <div class="editable-field">
                                <input type="date" name="dob" value="{{ dob|date:'Y-m-d' }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Bio</label>
                            <p class="field-value" data-field="bio">{{ bio|default:'' }}</p>
                            <div class="editable-field">
                                <textarea name="bio">{{ bio }}</textarea>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Academic Info -->
            <div class="tab-content" id="academic">
                <div class="academic-grid">

                    <div class="card">
                        <h3 class="card-title"><i data-lucide="graduation-cap"></i> Academic Details</h3>

                        <div class="form-field">
                            <label>Teacher ID</label>
                            <p class="field-value" data-field="teacher_id">{{ teacher_id|default:"-" }}</p>
                        </div>

                        <div class="form-field">
                          <label>Department / College</label>
                          <p class="field-value" data-field="department">{{ department|default:"CCS" }}</p>
                          <div class="editable-field">
                            <select name="department" class="styled-select">
                              <option value="CEA" {% if department == "CEA" %}selected{% endif %}>Engineering and Architecture (CEA)</option>
                              <option value="CCS" {% if department == "CCS" %}selected{% endif %}>Computer Studies (CCS)</option>
                              <option value="CASE" {% if department == "CASE" %}selected{% endif %}>Arts, Sciences and Education (CASE)</option>
                              <option value="CMBA" {% if department == "CMBA" %}selected{% endif %}>Management, Business and Accountancy (CMBA)</option>
                              <option value="CNAHS" {% if department == "CNAHS" %}selected{% endif %}>Nursing and Allied Health Sciences (CNAHS)</option>
                              <option value="CCJ" {% if department == "CCJ" %}selected{% endif %}>Criminal Justice (CCJ)</option>
                            </select>
                          </div>
                        </div>


                        <div class="form-field">
                            <label>Specialization</label>
                            <p class="field-value" data-field="specialization">{{ specialization|default:"N/A" }}</p>
                            <div class="editable-field">
                                <input type="text" name="specialization" value="{{ specialization }}">
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Date Joined</label>
                            <p class="field-value" data-field="date_joined">{{ date_joined|default:"-" }}</p>
                        </div>

                      <div class="form-field">
                        <label>Position</label>
                        <p class="field-value" data-field="position">{{ position|default:"Full-Time Faculty" }}</p>
                        <div class="editable-field">
                          <select name="position" class="styled-select">
                            <option value="Full-Time Faculty" {% if position == "Full-Time Faculty" %}selected{% endif %}>Full-Time Faculty</option>
                            <option value="Part-Time Faculty" {% if position == "Part-Time Faculty" %}selected{% endif %}>Part-Time Faculty</option>
                            <option value="Visiting Lecturer" {% if position == "Visiting Lecturer" %}selected{% endif %}>Visiting Lecturer</option>
                            <option value="Adjunct Faculty" {% if position == "Adjunct Faculty" %}selected{% endif %}>Adjunct Faculty</option>
                          </select>
                        </div>
                      </div>





                    </div>

                    <div class="card">
                        <h3 class="card-title"><i data-lucide="book-open"></i> Teaching Load</h3>

                        <div class="form-field">
                            <label>Current Courses</label>
                            <div class="gpa-display">
                                <span class="gpa-value" data-field="total_courses">{{ total_courses }}</span>
                                <span class="gpa-max"> courses</span>
                            </div>
                        </div>

                        <div class="form-field">
                            <label>Total Students</label>
                            <div class="credits-display">
                                <span class="credits-value" data-field="total_students">{{ total_students }}</span>
                                <span class="credits-max"> enrolled</span>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
                        </div>

                        <div class="form-field">
                            <label>Status</label>
                            <div class="status-badge success">Active</div>
                        </div>

                    </div>

                </div>
            </div>

            <!-- Achievements -->
            <div class="tab-content" id="achievements">
                <div class="card">
                    <h3 class="card-title"><i data-lucide="award"></i> Professional Achievements</h3>
                    <div class="achievements-grid" id="achievements-container">
                        {% for ach in achievements %}
                        <div class="achievement-card">
                            <i data-lucide="award"></i>
                            <h4>{{ ach.title }}</h4>
                            <p>{{ ach.description|default:'' }}</p>
                            <div class="editable-field">
                                <input type="text" name="achievement_{{ forloop.counter }}_title" value="{{ ach.title }}">
                                <input type="text" name="achievement_{{ forloop.counter }}_description" value="{{ ach.description }}">
                            </div>
                        </div>
                        {% empty %}
                        <p>No recorded achievements yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

        </div> <!-- end tabs -->
    </div> <!-- end profile-container -->

    <!-- Save/Cancel buttons -->
    <div class="profile-actions" style="display:none;" id="profile-actions">
        <button id="save-profile-button" class="save-button">Save Changes</button>
        <button id="cancel-profile-button" class="cancel-button">Cancel</button>
    </div>

</div>

<script>
lucide.createIcons();

// Tabs
document.querySelectorAll('.tab-trigger').forEach(trigger => {
    trigger.addEventListener('click', () => {
        const target = trigger.getAttribute('data-tab');
        document.querySelectorAll('.tab-trigger').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        trigger.classList.add('active');
        document.getElementById(target).classList.add('active');
    });
});

// Edit Mode
const editButton = document.getElementById('edit-profile-button');
const profileContainer = document.getElementById('profile-container');
const profileActions = document.getElementById('profile-actions');
const saveButton = document.getElementById('save-profile-button');
const cancelButton = document.getElementById('cancel-profile-button');

function toggleEditMode(enable) {
    if(enable) {
        profileContainer.classList.add('edit-mode');
        profileContainer.classList.remove('read-only');
        profileActions.style.display = 'flex';
    } else {
        profileContainer.classList.remove('edit-mode');
        profileContainer.classList.add('read-only');
        profileActions.style.display = 'none';
    }
}



editButton.addEventListener('click', () => {
    const isEditing = profileContainer.classList.contains('edit-mode');
    toggleEditMode(!isEditing);
});

// Cancel changes
cancelButton.addEventListener('click', () => {
    toggleEditMode(false);
    // reset inputs to original values
    document.querySelectorAll('.editable-field input, .editable-field textarea, .editable-field select').forEach(input => {
        const displayEl = document.querySelector(`.field-value[data-field="${input.name}"]`);
        if(displayEl) {
            if(input.tagName.toLowerCase() === 'select') {
                input.value = displayEl.textContent;
            } else {
                input.value = displayEl.textContent;
            }
        }
    });
});

// Save changes
saveButton.addEventListener('click', () => {
    const formData = {};
    document.querySelectorAll('#profile-container .editable-field input, #profile-container .editable-field textarea, #profile-container .editable-field select').forEach(input => {
        formData[input.name] = input.value;
    });

    fetch("{% url 'UpdateTeacherProfile' %}", {
        method:'POST',
        headers:{
            'Content-Type':'application/json',
            'X-CSRFToken':'{{ csrf_token }}'
        },
        body: JSON.stringify(formData)
    }).then(res => res.json()).then(data => {
        if(data.status==='success'){
            for(const key in formData){
                const display = document.querySelector(`.field-value[data-field="${key}"]`);
                if(display) display.textContent = formData[key];
            }
            const fullNameEl = document.querySelector('[data-field="full_name"]');
            if(fullNameEl) fullNameEl.textContent = `${formData.first_name} ${formData.last_name}`;
            toggleEditMode(false);
            alert("Profile updated successfully!");
        } else alert("Error: "+(data.message||"Unknown"));
    }).catch(err=>{
        console.error(err);
        alert("An error occurred.");
    });
});

// Live update while typing/selecting
document.querySelectorAll('.editable-field input, .editable-field textarea, .editable-field select').forEach(input => {
    input.addEventListener('input', () => {
        const el = document.querySelector(`.field-value[data-field="${input.name}"]`);
        if(el) el.textContent = input.value;
    });
});
</script>


{% endblock %}
